[manifest]
version = "1.0.0"
dump_lua = true
priority = 0

[[patches]]
[patches.pattern]
target = 'functions/UI_definitions.lua'
match_indent = true
position = 'after'
pattern = '''
info_boxes = {{n=G.UIT.R, config = {align="cm", padding = 0.05, card_pos = card.T.x }, nodes = info_cols}}
'''
payload = '''
local AUT2
if card.config.center_key == "Ruby_stocking_merchandise" then
    if not card.dummy then
        card.dummy = StockingStuffer.Ruby.get_dummy(G.P_CENTERS[card.ability.extra.joker], G.jokers, card)
        card.dummy.added_to_deck = true
        if card.ability.extra.dummy_abil then card.dummy.ability = card.ability.extra.dummy_abil end
    end
    AUT2 = Card.generate_UIBox_ability_table(card.dummy)
end
'''


[[patches]]
[patches.pattern]
target = 'functions/UI_definitions.lua'
match_indent = true
position = 'before'
pattern = '''
if multi_boxes[1] then
'''
payload = '''
if AUT2 then
local target = ret_val.nodes[1].nodes[1].nodes[1].nodes
    table.insert(target, #target, name_from_rows(AUT2.name, is_playing_card and G.C.WHITE or nil))
    table.insert(target, #target, desc_from_rows(AUT2.main))
end
'''

[[patches]]
[patches.pattern]
target = 'card.lua'
match_indent = true
position = 'at'
pattern = '''
if self.ability.name ~= 'Seeing Double' and self.ability.x_mult > 1 and (self.ability.type == '' or next(context.poker_hands[self.ability.type])) then
'''
payload = '''
if self.ability.name ~= 'Seeing Double' and  self.ability.x_mult and self.ability.x_mult > 1 and (self.ability.type == '' or next(context.poker_hands[self.ability.type] or {})) then
'''